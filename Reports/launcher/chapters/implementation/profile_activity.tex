\section{Profile Select Activity}

The \activity{ProfileSelectActivity} activity implements the behavior described in \autoref{design:profile_selection}, and takes care of providing the profile service, described in \autoref{external_architecture}, to the launched \girafapp[].

As explained in \autoref{external_architecture}, the \guardian[] should be able to launch apps with all profiles which are attached to the \guardian[]. \autoref{lst:snipgetprofiles} shows how all profiles are found, including those in attached departments, and their subdepartments.

\begin{lstlisting}[style=sourceCode, language=JAVA, caption=Snippet of the \method{loadApplications} method, label=lst:snipgetprofiles]
		...
		mChildren = new ArrayList<Profile>();
		Profile guardianProfile = helper.profilesHelper.getProfileById(mGuardianID);
		List<Profile> guardianChildren = helper.profilesHelper.getChildrenByGuardian(guardianProfile);
		List<Department> guardianDepartments = helper.departmentsHelper.getDepartmentsByProfile(guardianProfile);
		List<Profile> totalChildren = new ArrayList<Profile>();
		totalChildren.addAll(guardianChildren);
		
		for (Department department : guardianDepartments) {
			List<Profile> childrenFromDepartments = helper.profilesHelper.getChildrenByDepartmentAndSubDepartments(department);
			
			totalChildren.addAll(childrenFromDepartments);
		}
		
		// Removing duplicate profiles
		...
\end{lstlisting}

The profile service is provided with intents, as shown in \autoref{lst:snipprovideprofile}.

\begin{lstlisting}[style=sourceCode, language=JAVA, caption=Snippet of the \method{loadApplications} method, label=lst:snipprovideprofile]
		// When a child is selected, launch the app that was chosen with the correct data in the extras.
		listOfChildren.setOnItemClickListener(new OnItemClickListener() {
			public void onItemClick(AdapterView<?> parent, View view, int position, long id) {
				final long childID = ((Profile) parent.getAdapter().getItem(position)).getId();

				Intent intent = new Intent(Intent.ACTION_MAIN);
				intent.addCategory(Intent.CATEGORY_LAUNCHER);
				intent.setComponent(new ComponentName(mPackageName, mActivityName));
				intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK
						| Intent.FLAG_ACTIVITY_RESET_TASK_IF_NEEDED);

				intent.putExtra(Data.CHILDID, childID);
				intent.putExtra(Data.GUARDIANID, mGuardianID);
				intent.putExtra(Data.APP_COLOR, mAppColor);

				startActivity(intent);
			}
		});
\end{lstlisting}

The launched \girafapp[] can retrieve the chosen profile, by following our specification, as seen in \todo{indsaet ref til vores speficikation af, hvordan man laeser hvilken profile der er valgt}.