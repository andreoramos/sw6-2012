\section{sound}

In our application we are making sentences by using pictograms. These pictograms consists of an image, as well as two optional sounds, as described in \textbf{INSERT REF!!!!!!!!!}, the reason for this being that it might help with communication and learning the concepts of what that pictogram illustrates.\newline

To use the a sound of a pictogram, the application needs to include an audio player so that the sound can be played. Fortunately for the development team, the group who previously worked on the project have already written a functional audio player, which have been easily included in the PARROT application.\newline
In PARROT, the playing of sounds are handled in two different places in cooperation, the Pictogram class and the AudioPlayer class.\newline
The Pictogram class handles the data, and starts up the AudioPlayer wheneven it is needed.\newline

%Replace the with a code box instead?
\begin{\begin{verbatim}{}
	private void playItem(final String path) {
		// Running this in the background to keep UI reponsive and smooth
		new Thread(new Runnable() {
			public void run() {
				try {
					AudioPlayer.play(path, null);
				} catch (Exception e) {
				}
			}
		}).start();
		//TODO check that the thread is stopped again at some point.
	}

	public void playSound()
	{
		if(soundPath!=null && validPath(soundPath))
		{
			playItem(soundPath);
		}
	}

	public void playWord()
	{
		if(wordPath!=null &&validPath(wordPath))
		{
			playItem(wordPath);
		}
	}
\end{verbatim}

For instance, suppose we want to play the word of a pictogram (The word is a sound file with the pronounciation of the pictogram). The first thing we do is call the \textbf{playWord} method form the Pictogram in question. This method cheks if the pictogram has a word, and if the path of that word corresponds to an existing sound file. If this is correct, it will call the \textbf{playItem} with its path as the input. The playItem then starts a new thread in which it makes the AudioPlayer play the corresponding sound. The reason for starting a new thread is that the user interface would become unresponsive while the sound was playing otherwise.\newline
The actual functionality that plays the sound is found the AudioPlayer class, more specifically the static \textbf{play} method.\newline

\begin{\begin{verbatim}{}
	public static void play(String path, final OnCompletionListener listener)
	{
		AudioPlayer ap = getInstance();
		 
		try {
			ap.mMediaPlayer.reset();
			ap.mMediaPlayer.setDataSource(path);
			ap.mMediaPlayer.prepare();
			if (listener != null)
				ap.mMediaPlayer.setOnCompletionListener(listener);
			ap.mMediaPlayer.start(); 
		} catch (IllegalArgumentException e) {
			Log.e("sw6", "Media player throw exception, see stack trace");
			e.printStackTrace();
		} catch (IllegalStateException e) {
			Log.e("sw6", "Media player throw exception, see stack trace");
			e.printStackTrace();
		} catch (IOException e) {
			Log.e("sw6", "Media player throw exception, see stack trace");
			e.printStackTrace();
		} 
	}
\end{verbatim}

What happens here is that the internal MediaPlayer object (A native android class) is reset, fed with data, and prepared for playing the sound. The MediaPlayer object is then started with the \textbf{start} method, which causes it to play the sound, If an error occurs, it will be caught, no sound will be played, and the error will be written to the log.